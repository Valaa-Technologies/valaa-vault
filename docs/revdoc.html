<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>ReVDoc - ReSpec document VDoc extension</title>
    <script
     src='https://www.w3.org/Tools/respec/respec-w3c-common'
     class='remove'></script>
    <script class='remove'>
      var respecConfig = {"subtitle":"0.35.0-prerelease.13","specStatus":"unofficial","editors":[{"name":"Iridian Kiiskinen","url":"https://valaatech.github.io/fabric/authors/iridian","github":"http://github.com/valospace"}],"shortName":"revdoc","alternateFormats":[{"label":"VDoc","uri":"revdoc.jsonld"}]};
    </script>
    <link rel = "stylesheet" type = "text/css" href = "/summary.css" />

  </head>
  <body>

  <section id="abstract" class="vdoc type-vdoc-chapter">This document specifies ReVDoc, a <a href="https://valospace.org/vdoc#extension" class="vdoc type-vdoc-reference">VDoc extension</a> for extracting and emitting <a href="https://github.com/w3c/respec" class="vdoc type-vdoc-reference">ReSpec documents</a>.
  </section>

  <section id="sotd" class="vdoc type-vdoc-chapter">      <p>This document has not been reviewed. This is a draft document and
    may be updated, replaced or obsoleted by other documents at any
    time.</p>
      <p>This document is part of the <a href="@valos/kernel/spec" class="vdoc type-vdoc-reference">ValOS core specification</a>.</p>
      <p>The format is implemented and supported by <a href="https://valospace.org/revdoc" class="vdoc type-revdoc-package"><em>@valos/revdoc</em></a> npm package.</p>

  </section>

  <section id="introduction" class="vdoc type-vdoc-chapter">ReVDoc is a VDoc extension which can produce ReSpec documents.
  </section>

  <section id="ontology" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc ontology</h2>
ReVDoc ontology provides vocabulary and definitions which are
      tailored for emitting ReSpec html output documents.
  <section id="section_prefixes" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc IRI prefixes</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">Prefix</th>
        <th class="vdoc type-vdoc-header">IRI</th>
      </thead>
      <tbody>
        <tr><td>revdoc</td><td>https://valospace.org/revdoc#</td></tr>
      </tbody>
    </table>

  </section>

  <section id="section_classes" class="vdoc type-vdoc-chapter">
    <h2>&#x3C;em&#x3E;revdoc:* a vdoc:Class&#x3C;/em&#x3E; vocabulary</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">rdfs:label</th>
        <th class="vdoc type-vdoc-header">rdfs:subClassOf</th>
      </thead>
      <tbody>
        <tr id="Document" class=" vdoc-nth-child-2n"><td><a href="#Document" class="vdoc type-vdoc-reference"><em>Document</em></a></td><td>vdoc:Chapter</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=2>A ReSpec specification document</td></tr>
        <tr id="Example"><td><a href="#Example" class="vdoc type-vdoc-reference"><em>Example</em></a></td><td>vdoc:Node</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=2>A ReSpec example node</td></tr>
        <tr id="Definition" class=" vdoc-nth-child-2n"><td><a href="#Definition" class="vdoc type-vdoc-reference"><em>Definition</em></a></td><td>vdoc:Node</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=2>A ReSpec term definition document node</td></tr>
        <tr id="Package"><td><a href="#Package" class="vdoc type-vdoc-reference"><em>Package</em></a></td><td>vdoc:Reference</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=2>A package reference document node</td></tr>
        <tr id="ABNF" class=" vdoc-nth-child-2n"><td><a href="#ABNF" class="vdoc type-vdoc-reference"><em>ABNF</em></a></td><td>vdoc:CharacterData</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=2>An ABNF section node</td></tr>
        <tr id="Turtle"><td><a href="#Turtle" class="vdoc type-vdoc-reference"><em>Turtle</em></a></td><td>vdoc:CharacterData</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=2>An Turtle section node</td></tr>
        <tr id="Invokation" class=" vdoc-nth-child-2n"><td><a href="#Invokation" class="vdoc type-vdoc-reference"><em>Invokation</em></a></td><td>vdoc:Node</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=2>A command invokation document node</td></tr>
        <tr id="Command"><td><a href="#Command" class="vdoc type-vdoc-reference"><em>Command</em></a></td><td>vdoc:ContextPath</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=2>A command reference node</td></tr>
        <tr id="CommandLineInteraction" class=" vdoc-nth-child-2n"><td><a href="#CommandLineInteraction" class="vdoc type-vdoc-reference"><em>CommandLineInteraction</em></a></td><td>revdoc:Example</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=2>A command line interaction sequence document node</td></tr>
      </tbody>
    </table>

  </section>

  <section id="section_properties" class="vdoc type-vdoc-chapter">
    <h2>&#x3C;em&#x3E;revdoc:* a vdoc:Property&#x3C;/em&#x3E; vocabulary</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">rdfs:label</th>
        <th class="vdoc type-vdoc-header">rdfs:subPropertyOf</th>
        <th class="vdoc type-vdoc-header">rdfs:domain</th>
        <th class="vdoc type-vdoc-header">rdfs:range</th>
      </thead>
      <tbody>
        <tr id="prefix" class=" vdoc-nth-child-2n"><td><a href="#prefix" class="vdoc type-vdoc-reference"><em>prefix</em></a></td><td></td><td>revdoc:Document</td><td>rdfs:Literal</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=4>The preferred prefix of an ontology document</td></tr>
        <tr id="prefixIRI"><td><a href="#prefixIRI" class="vdoc type-vdoc-reference"><em>prefixIRI</em></a></td><td></td><td>revdoc:Document</td><td>rdfs:Resource</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=4>The IRI associated with the preferred prefix of an ontology</td></tr>
        <tr id="package" class=" vdoc-nth-child-2n"><td><a href="#package" class="vdoc type-vdoc-reference"><em>package</em></a></td><td></td><td>vdoc:Node</td><td>rdfs:Literal</td></tr>
        <tr class="vdoc vdoc-wide vdoc-nth-child-2n"><td><em>rdfs:comment</em></td><td colspan=4>A package name</td></tr>
        <tr id="version"><td><a href="#version" class="vdoc type-vdoc-reference"><em>version</em></a></td><td></td><td>vdoc:Node</td><td>rdfs:Literal</td></tr>
        <tr class="vdoc vdoc-wide"><td><em>rdfs:comment</em></td><td colspan=4>A semver string</td></tr>
      </tbody>
    </table>

  </section>

  <section id="section_vocabulary_other" class="vdoc type-vdoc-chapter">
    <h2>&#x3C;em&#x3E;revdoc:&#x3C;/em&#x3E; other vocabulary</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">rdfs:label</th>
        <th class="vdoc type-vdoc-header">rdf:type</th>
        <th class="vdoc type-vdoc-header">rdfs:subClassOf</th>
      </thead>
      <tbody>

      </tbody>
    </table>

  </section>

  <section id="section_context" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc JSON-LD context term definitions</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">Term</th>
        <th class="vdoc type-vdoc-header">Definition</th>
        <th class="vdoc type-vdoc-header">@id</th>
        <th class="vdoc type-vdoc-header">@type</th>
        <th class="vdoc type-vdoc-header">@container</th>
      </thead>
      <tbody>

      </tbody>
    </table>

  </section>

  </section>

  <section id="transformations" class="vdoc type-vdoc-chapter">ReVDoc lightly extends basic VDoc extraction with some
      ReSpec specific primitives and specifies a ReSpec html emission
      transformation.
  <section id="extraction_rules" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc extraction rules</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">Rule name</th>
        <th class="vdoc type-vdoc-header">Inter-node rdf:type</th>
        <th class="vdoc type-vdoc-header">Owner property</th>
        <th class="vdoc type-vdoc-header">Body property</th>
        <th class="vdoc type-vdoc-header">&#x27;;rest&#x27; property</th>
        <th class="vdoc type-vdoc-header">Comment</th>
      </thead>
      <tbody>
        <tr><td>example</td><td>vdoc:Example</td><td>vdoc:content</td><td>vdoc:content</td><td>dc:title</td><td>Example node</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>ontology</td><td>vdoc:Chapter</td><td>vdoc:content</td><td>vdoc:content</td><td>dc:title</td><td>Ontology specification chapter</td></tr>
      </tbody>
    </table>

  </section>

  <section id="extractee_api" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc extractee API</h2>

    <table class="vdoc type-vdoc-table">
      <thead>
        <th class="vdoc type-vdoc-header">API identifier</th>
        <th class="vdoc type-vdoc-header">rdf:type</th>
      </thead>
      <tbody>
        <tr><td>abnf</td><td>abnf(text) {
    // Add validation and maybe restructuring?
    return {
      // TODO(iridian, 2019-08): Figure out if there's any sense in
      // providing language identifiers for non-natural languages.
      ...c("https://tools.ietf.org/html/rfc5234", text),
      "@type": "revdoc:ABNF",
    };
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>turtle</td><td>turtle(text) {
    // Add validation and maybe restructuring?
    return {
      // TODO(iridian, 2019-08): Figure out if there's any sense in
      // providing language identifiers for non-natural languages.
      ...c("https://www.w3.org/TR/turtle/", text),
      "@type": "revdoc:Turtle",
    };
  }</td></tr>
        <tr><td>authors</td><td>authors(...authorNames) {
    const toolsetsPath = `${process.cwd()}/toolsets.json`;
    const authorLookup = (((require(toolsetsPath)["@valos/type-vault"] || {})
        .tools || {}).docs || {}).authors || {};
    return (authorNames || []).map(authorName => {
      const author = authorLookup[authorName];
      if (!author) {
        throw new Error(`Cannot find author '${authorName}' from toolsetConfig("${
          toolsetsPath}")["@valos/type-vault"].tools.docs.authors`);
      }
      return author;
    });
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>dfn</td><td>dfn(text, definitionId, ...explanation) {
    return aggregate({
      "revdoc:dfn": definitionId,
      "vdoc:content": [strong(ref(text, definitionId))],
    }, "vdoc:content", ...explanation);
  }</td></tr>
        <tr><td>pkg</td><td>pkg(packageName, ...rest) {
    return {
      ...ref(em(packageName), packageName, ...rest),
      "@type": "revdoc:Package",
    };
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>command</td><td>command(commandName) {
    return {
      ...cpath(commandName),
      "@type": "revdoc:Command",
    };
  }</td></tr>
        <tr><td>invokation</td><td>invokation(...parts) {
    return {
      "@type": "revdoc:Invokation",
      "vdoc:words": [].concat(...parts.map(
              part => (typeof part !== "string" ? [part] : part.split(/(\s+)/))))
          .filter(w => (typeof w !== "string") || !w.match(/^\s+$/))
          .map((w, i) => ((i || typeof w !== "string") ? w : module.exports.command(w))),
    };
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>cli</td><td>cli(...rows) {
    const commandedRows = rows.map(line => ((typeof line !== "string")
        ? line
        : module.exports.invokation(line)));
    let currentContext = "";
    const contextedRows = [];
    for (const row of commandedRows) {
      if ((row != null) && (row["@type"] === "vdoc:ContextBase")) {
        currentContext = row;
      } else {
        contextedRows.push([currentContext, "$ ", row]);
      }
    }
    return {
      "@type": "revdoc:CommandLineInteraction",
      "vdoc:entries": contextedRows,
    };
  }</td></tr>
        <tr><td>filterKeysWithAnyOf</td><td>filterKeysWithAnyOf(entryFieldName, searchedValueOrValues = [], container) {
    return filterKeysWithFieldReduction(entryFieldName, searchedValueOrValues, container,
        (a, [field, searched]) => a || field.includes(searched));
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>filterKeysWithAllOf</td><td>filterKeysWithAllOf(entryFieldName, searchedValueOrValues = [], container) {
    return filterKeysWithFieldReduction(entryFieldName, searchedValueOrValues, container,
        (a, [field, searched]) => a && field.includes(searched), true);
  }</td></tr>
        <tr><td>filterKeysWithNoneOf</td><td>filterKeysWithNoneOf(entryFieldName, searchedValueOrValues = [], container) {
    return filterKeysWithFieldReduction(entryFieldName, searchedValueOrValues, container,
        (a, [field, searched]) => a && !field.includes(searched), true);
  }</td></tr>
        <tr class=" vdoc-nth-child-2n"><td>filterKeysWithFieldReduction</td><td>function filterKeysWithFieldReduction(entryFieldName, searchedValueOrValues, container,
    reduction, initial) {
  const searchedValues = [].concat(
      searchedValueOrValues !== undefined ? searchedValueOrValues : []);
  return Object.entries(container)
      .filter(([, entry]) => searchedValues
          .reduce((a, searchedValue) => reduction(a, [
            [].concat(entry[entryFieldName] !== undefined ? entry[entryFieldName] : []),
            searchedValue,
          ]), initial))
      .map(([key]) => key);
}</td></tr>
      </tbody>
    </table>

  </section>

  <section id="emission_output" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc emission output</h2>
ReVDoc emits html which makes use of ReSpec primitives.
  </section>

  <section id="emission_rules" class="vdoc type-vdoc-chapter">
    <h2>ReVDoc emission rules</h2>
ReVDoc provides html emission rules for vdoc:Document revdoc:Document vdoc:Chapter vdoc:Reference revdoc:Invokation revdoc:Command revdoc:Example
  </section>

  </section>

  </body>
</html>
